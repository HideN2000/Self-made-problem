LowestCommonAncestorを2ベキの累乗法の応用(ダブリング)で求め

各点におけるノードの優先度に関する

トポロジカルソートを行いその後にdfsを行うことで解けます．

計算のコストは全体を通して$QlogN + N$くらいですが係数がやや大きめであり

高速な言語を選択する必要があるかもしれません